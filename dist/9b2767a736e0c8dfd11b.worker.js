!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,i=r;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}},function(e,t,r){var n=r(3),i=r(4),s=i;s.v1=n,s.v4=i,e.exports=s},function(e,t,r){var n,i,s=r(0),o=r(1),u=0,a=0;e.exports=function(e,t,r){var h=t&&r||0,l=t||[],d=(e=e||{}).node||n,m=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==m){var c=s();null==d&&(d=n=[1|c[0],c[1],c[2],c[3],c[4],c[5]]),null==m&&(m=i=16383&(c[6]<<8|c[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:a+1,y=f-u+(g-a)/1e4;if(y<0&&void 0===e.clockseq&&(m=m+1&16383),(y<0||f>u)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=f,a=g,i=m;var p=(1e4*(268435455&(f+=122192928e5))+g)%4294967296;l[h++]=p>>>24&255,l[h++]=p>>>16&255,l[h++]=p>>>8&255,l[h++]=255&p;var v=f/4294967296*1e4&268435455;l[h++]=v>>>8&255,l[h++]=255&v,l[h++]=v>>>24&15|16,l[h++]=v>>>16&255,l[h++]=m>>>8|128,l[h++]=255&m;for(var b=0;b<6;++b)l[h+b]=d[b];return t||o(l)}},function(e,t,r){var n=r(0),i=r(1);e.exports=function(e,t,r){var s=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||n)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var u=0;u<16;++u)t[s+u]=o[u];return t||i(o)}},function(e,t,r){"use strict";r.r(t),r.d(t,"startFighting",(function(){return S})),r.d(t,"addConsumedFrameNumber",(function(){return T})),r.d(t,"moveHero",(function(){return N})),r.d(t,"buyHero",(function(){return x})),r.d(t,"restartGame",(function(){return P}));let n=function(e,t,r){let n=[],i=(e-r*(t-1))/2;for(let e=0;e<t;e++)n.push(i),i+=r;return n}(1e3,9,90);const i=n.map((e,t)=>({x:e,y:70})),s=n.map((e,t)=>({x:e,y:220}));class o{constructor(){this.bullets=[]}copy(){return this.bullets.map(e=>e.copy())}go(){this.bullets=this.bullets.filter(e=>!e.isDied&&(e.go(),!0))}add(e){this.bullets.push(e)}}class u{constructor(){this.value=0}add(){this.value++}}class a extends class{constructor(){this.isDied=!1}go(){}copy(){return{isDied:this.isDied}}}{constructor(e,t){super(),this.x=0,this.y=0,this.size=4,this.direction=0,this.speed=200,this.ATK=1,this.isDied=!1,this.game=e,this.hero=t,this.x=this.hero.x,this.y=this.hero.y+1700,this.direction=.4*Math.PI*(Math.random()-.5),0===this.direction&&(this.direction=.1*Math.PI),this.speed=500+Math.floor(500*Math.random())}copy(){return{x:this.x,y:this.y,size:this.size,direction:this.direction,speed:this.speed,ATK:this.ATK,isDied:this.isDied}}go(){for(let e=0;e<this.speed;e++){if(this.x+=Math.sin(this.direction),this.y-=Math.cos(this.direction),this.y<0||this.y>2e3||this.x<0||this.x>1e3)return void(this.isDied=!0);let e=this.game.currentRound.enemySet.findEnemyByPoint(Math.round(this.x),Math.round(this.y));if(e){return e.hited(this.ATK)&&this.game.$++,void(this.isDied=!0)}}}}var h=r(2);class l{constructor(e){this.level=1,this.killNumber=0,this.id=Object(h.v4)(),this.x=0,this.y=0,this.game=e}static fromPosition(e,t){let r=new l(e);return r.setPosition(t),r}go(){}setPosition(e){this.x=e.x,this.y=e.y}}class d extends l{constructor(){super(...arguments),this.cycle=5,this.bulletNumber=5}static fromPosition(e,t){let r=new d(e);return r.setPosition(t),r}go(){if(this.game.frameCounter.value%this.cycle==0)for(let e=0;e<this.bulletNumber;e++)this.game.bulletSet.add(new a(this.game,this))}}class m{constructor(e){this.offStageHero=[null,null,null,null,null,null,null,null,null],this.onStageHero=[null,null,null,null,null,null,null,null,null],this.onStageNotNullHero=[],this.operationTime=0,this.game=e}get canBuyNumber(){return this.offStageHero.filter(e=>!e).length}copyOffStageHero(){return this.offStageHero.map(e=>e&&{level:e.level,killNumber:e.killNumber,id:e.id,x:e.x,y:e.y})}copyOnStageHero(){return this.onStageHero.map(e=>e&&{level:e.level,killNumber:e.killNumber,id:e.id,x:e.x,y:e.y})}go(){this.onStageNotNullHero.forEach(e=>e.go())}add(e){let t=this.offStageHero.findIndex(e=>!e);let r=s[t];switch(e){case"grapeshotHero":default:this.offStageHero[t]=d.fromPosition(this.game,r)}}move(e,t){let r="on"===e.stage?this.onStageHero:this.offStageHero,n="on"===e.stage?i:s,o=r[e.index],u="on"===t.stage?this.onStageHero:this.offStageHero,a="on"===t.stage?i:s,h=u[t.index];r[e.index]=h,h&&h.setPosition(n[e.index]),u[t.index]=o,o&&o.setPosition(a[t.index]),this.onStageNotNullHero=this.onStageHero.filter(Boolean)}}class c{constructor(e,t,r){this.value=0,this.index=0,this.game=e,this.value=t,this.index=r}copy(){return{value:this.value,index:this.index}}hited(e){let t=this.value<e?this.value:e;this.game.score+=t,this.value-=t;let r=this.value<=0;return r&&this.game.currentRound.enemySet.aliveEnemyNumber--,r}}class f{constructor(e){this.enemys=[],this.aliveEnemyNumber=0,this.enemyOnGroundQueue=null,this.lengthTraveled=-52,this.speed=f.initSpeed,this.endLineIndex=0,this.round=e,this.prepareEnemySet()}copy(){return{enemys:this.enemys.map(e=>e&&e.copy()),aliveEnemyNumber:this.aliveEnemyNumber,lengthTraveled:this.lengthTraveled}}prepareEnemySet(){let e=[];for(let t=0;t<450;t++)e.push(new c(this.round.game,Math.ceil(Math.random()*(2*this.round.roundNumber-1+.1*Math.floor(t/15))),t));this.enemys=e,this.aliveEnemyNumber=450;let t={enemy:e[0],next:null};this.enemyOnGroundQueue=t;for(let r=0;r<450;r++)t=t.next={enemy:e[r],next:null}}go(){this.lengthTraveled+=this.speed,this.enemyCrossEndLine()}enemyCrossEndLine(){if(this.lengthTraveled<1700)return;let e=15*Math.ceil((this.lengthTraveled-1700)/65);for(;this.enemyOnGroundQueue&&this.enemyOnGroundQueue.enemy.index<e;){let e=this.enemyOnGroundQueue.enemy.value;e&&this.aliveEnemyNumber--,this.round.game.HP-=e,this.round.game.HP<0&&(this.round.game.HP=0),this.enemyOnGroundQueue.enemy.value=0,this.enemyOnGroundQueue=this.enemyOnGroundQueue.next}}findEnemyByPoint(e,t){if((e-15)%65>50||(t%65+this.lengthTraveled%65)%65>50)return null;let r=Math.ceil((e-15)/65);if(r<1||r>15)return null;let n=this.enemys[15*(30-Math.floor((t-this.lengthTraveled+1950)/65))+r-1];return n&&n.value?n:null}}f.initSpeed=3;var g=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(e){s(e)}}function u(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}a((n=n.apply(e,t||[])).next())}))};class y{constructor(e,t){this.isWorkLoopRunning=!1,this.roundNumber=0,this.producedFrameNumber=0,this.consumedFrameNumber=0,this.game=e,this.roundNumber=t,this.enemySet=new f(this)}startBattle(){this.producedFrameNumber=0,this.consumedFrameNumber=0,this.battleTurnWorkLoop()}battleTurnWorkLoop(){return g(this,void 0,void 0,(function*(){for(this.isWorkLoopRunning=!0;!this.isBattleToTheEnd();)if(this.game.frameCounter.add(),this.enemySet.lengthTraveled<300){if(this.enemySet.speed=Math.floor((300-this.enemySet.lengthTraveled)/6)+1,this.enemySet.go(),this.game.produceFrame(),this.producedFrameNumber++,this.enemySet.lengthTraveled>=300&&(this.enemySet.speed=f.initSpeed),yield p(),this.shouldPause())return void(this.isWorkLoopRunning=!1)}else if(this.enemySet.go(),0!==this.enemySet.aliveEnemyNumber&&this.game.heroSet.go(),this.game.bulletSet.go(),this.game.produceFrame(),this.producedFrameNumber++,yield p(),this.shouldPause())return void(this.isWorkLoopRunning=!1);this.game.HP<=0?this.game.isGameOver=!0:this.game.currentRound=new y(this.game,this.roundNumber+1),this.game.toggleToStrategyTurn(),this.game.produceFrame(),this.isWorkLoopRunning=!1}))}addConsumedFrameNumber(){this.consumedFrameNumber++,this.isWorkLoopRunning||"BATTLE_TURN"!==this.game.currentTurn||this.battleTurnWorkLoop()}shouldPause(){return this.producedFrameNumber-this.consumedFrameNumber>200}isBattleToTheEnd(){return(this.game.HP<=0||this.enemySet.aliveEnemyNumber<=0)&&this.game.bulletSet.bullets.length<=0}}function p(){return new Promise((e,t)=>{setTimeout(()=>e(null),0)})}var v=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(e){s(e)}}function u(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}a((n=n.apply(e,t||[])).next())}))};const b=new class{constructor(){this.heroSet=new m(this),this.bulletSet=new o,this.currentRound=new y(this,1),this.frameCounter=new u,this.frameBuffer=[],this.requestPushFrame=!1,this.isGameOver=!1,this.currentTurn="STRATEGY_TURN",this.HP=1e3,this.$=500,this.score=0,this.initial()}initial(){this.heroSet=new m(this),this.bulletSet=new o,this.currentRound=new y(this,1),this.frameCounter=new u,this.frameBuffer=[],this.requestPushFrame=!1,this.isGameOver=!1,this.currentTurn="STRATEGY_TURN",this.HP=1e3,this.$=500,this.score=0,this.produceFrame(),this.pushFrame()}restart(){this.initial()}toggleToBattleTurn(){"BATTLE_TURN"!==this.currentTurn&&(this.requestPushFrame=!0,this.currentTurn="BATTLE_TURN",this.currentRound.startBattle())}toggleToStrategyTurn(){"STRATEGY_TURN"!==this.currentTurn&&(this.currentTurn="STRATEGY_TURN")}produceFrame(){this.frameBuffer.push({currentTurn:this.currentTurn,HP:this.HP,enemys:this.currentRound.enemySet.copy(),onStageHero:this.heroSet.copyOnStageHero(),offStageHero:this.heroSet.copyOffStageHero(),bullets:this.bulletSet.copy(),roundNumber:this.currentRound.roundNumber,$:this.$,heroSetOperationTime:this.heroSet.operationTime,bufferFrameNumber:this.currentRound.producedFrameNumber-this.currentRound.consumedFrameNumber,isGameOver:this.isGameOver}),this.requestPushFrame&&this.pushFrame()}pushFrame(){0!==this.frameBuffer.length&&(self.postMessage({type:"PUSH_FRAMES",frames:this.frameBuffer}),this.frameBuffer=[],this.requestPushFrame=!1)}},S=()=>v(void 0,void 0,void 0,(function*(){b.toggleToBattleTurn()})),T=()=>v(void 0,void 0,void 0,(function*(){b.currentRound.addConsumedFrameNumber(),b.requestPushFrame=!0,b.pushFrame()})),N=(e,t)=>v(void 0,void 0,void 0,(function*(){return b.heroSet.move(e,t),{onStageHero:b.heroSet.copyOnStageHero(),offStageHero:b.heroSet.copyOffStageHero()}})),x=e=>v(void 0,void 0,void 0,(function*(){b.heroSet.add(e),b.heroSet.operationTime++,"STRATEGY_TURN"===b.currentTurn&&(b.requestPushFrame=!0,b.produceFrame())})),P=()=>v(void 0,void 0,void 0,(function*(){b.restart()}));t.default=()=>({startFighting:S,addConsumedFrameNumber:T,moveHero:N,buyHero:x,restartGame:P,addEventListener:self.addEventListener});addEventListener("message",(function(e){var r,n=e.data,i=n.type,s=n.method,o=n.id,u=n.params;"RPC"===i&&s&&((r=t[s])?Promise.resolve().then((function(){return r.apply(t,u)})):Promise.reject("No such method")).then((function(e){postMessage({type:"RPC",id:o,result:e})})).catch((function(e){var t={message:e};e.stack&&(t.message=e.message,t.stack=e.stack,t.name=e.name),postMessage({type:"RPC",id:o,error:t})}))})),postMessage({type:"RPC",method:"ready"})}]);